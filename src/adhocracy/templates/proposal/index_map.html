<%inherit file="${context.get('root_template', '/root.html')}" />
<%namespace name="components" file="/components.html"/>
<%namespace name="forms" file="/forms.html"/>
<%namespace name="map" file="/geo/map.html"/>
<%def name="title()">${_("Map")}</%def>

<%def name="breadcrumbs()">
    ${h.proposal.breadcrumbs(None)|n}
</%def>

<%block name="head">
${components.head(self.title)}
<style type="text/css">
    body {overflow: hidden;}
</style>
</%block>

<%block name="main">
<div id="fullscreen_map">

    <div id="left_block">
        <div id="hide_list_icon"></div>
        <div class="list_filter" id="proposals-search">
            ${forms.search(name='proposals_q', placeholder=_(u'Find proposals'), value=request.params.get('proposals_q', ''))}
        </div>
        <div id="proposals_table" class="table">
            ${c.proposals_pager.render_pager()}
        </div>

        <div class="top_actions aside" id="new-proposal">
            <% auth = check.proposal.create() %>
            %if auth:
            <a class="button add ttip" title="${_('Introduce a new idea to debate.')}" href="${h.base_url('/proposal/new')}">${_("new proposal")}</a>
            %elif auth.propose_join():
            <a class="button add ttip" title="${_('Join instance to create a new proposal.')}" href="${h.base_url('/proposal/new')}" rel="#overlay-join-button">${_("new proposal")}</a>
            %elif auth.propose_login():
            <a class="button add ttip" title="${_('Login to create a new proposal.')}" href="${h.base_url('/proposal/new')}" rel="#overlay-login-button">${_("new proposal")}</a>
            %endif

        </div>
    </div>

    <div id="central_block">

        <div id="show_list_icon"></div>

        %if can.norm.create() and h.geo.use_page_geotags():
        <a id="create_map_page" class="button_round" href="${h.base_url('/page/new')}">${_('Create area')}</a>
        %endif

        <%doc>filter if p is not None in list comprehension is just a workaround, as SolrPager seems to return None proposals accidently</%doc>
        ${map.show_region_map_large([p.id for p in c.proposals_pager.items if p is not None and p.geotag is not None], [p.id for p in c.pages_pager.items if p is not None and p.geotag is not None], full_region=not(bool(c.query)))}

    </div>

    <%doc>
    <div id="right_block">

        <div id="proposals_facets">
            ${c.proposals_pager.render_facets()}
        </div>
    </div>
    </%doc>
</div>
</%block>

<%block name="footer">
</%block>
